<script>
  var isShopgateApp = 1 || navigator.userAgent.indexOf('libshopgate') !== -1;

  console.warn(isShopgateApp);

  if (isShopgateApp) {
    var ready = function(){
      console.warn('ready');
      document.querySelector('#checkout .btn').addEventListener('click', function(e) {
        console.warn('click');
        e.preventDefault();

        window.SGAppConnector.sendAppCommand(
          {
            c: 'broadcastEvent',
            p: {
              event: 'closeInAppBrowser'
            }
          }
        );

      }, false);
    };

    if (
      document.readyState === "complete" ||
      (document.readyState !== "loading" && !document.documentElement.doScroll)
    ) {
      ready();
    } else {
      document.addEventListener("DOMContentLoaded", ready);
    }

    window.sgOrder = {
      orderNumber: "{{order_number}}",
      currency: document.querySelector('.payment-due__currency').innerText,
      totals: {
        shippingPrice: {{ total_shipping }} * 100,
        taxPrice: {{ total_tax }}  * 100 ,
        totalPrice: {{total_price}}  * 100
      },
      lineItems: []
    }

    {% for item in line_items %}
      window.sgOrder.lineItems.push({
        "product": {id: {{ item.product_id }} },
        "id": "{{ item.product_id }}",
        "variant_id": "{{ item.variant_id }}",
        "title": "{{ item.name }}",
        "quantity": {{ item.quantity }},
        "price": {{ item.price }},
      })
    {% endfor %}

  }
</script>
<script type='text/javascript' src='https://s3-eu-west-1.amazonaws.com/shopgate-public/webcheckout/shopify/checkout-script_v2.js'></script>